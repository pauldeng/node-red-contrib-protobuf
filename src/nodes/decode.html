<script type="text/javascript">
  RED.nodes.registerType("decode", {
    category: "protobuf",
    color: "#C0DEED",
    defaults: {
      name: { value: "" },
      protofile: { value: "", type: "protobuf-file" },
      protoType: { value: "" }
    },
    inputs: 1,
    outputs: 1,
    icon: "hash.png",
    label: function() {
      return this.name || "decode";
    }
  });
</script>

<script type="text/x-red" data-template-name="decode">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
      <label for="node-input-protofile"><i class="icon-file"></i> Proto File</label>
      <input type="text" id="node-input-protofile">
  </div>
  <div class="form-row">
      <label for="node-input-protoType"><i class="icon-tag"></i> Type</label>
      <input type="text" id="node-input-protoType" placeholder="Proto Message Type">
  </div>
</script>

<script type="text/x-red" data-help-name="decode">
  <p>Select a proto type definition from a proto file to decode incoming messages.</p>
  <h3>Inputs</h3>
  <dl class="message-properties">
      <dt>payload
          <span class="property-type">buffer</span>
      </dt>
      <dd>
          a buffer binary message containing the protobuf encoded message.
      </dd>
      <dt>protobufType
          <span class="property-type">string</span>
      </dt>
      <dd>
          the identifier string of the corresponding protobuf type definition of the message.
      </dd>
  </dl>
  <h3>Outputs</h3>
  <dl class="message-properties">
      <dt>payload
          <span class="property-type">object</span>
      </dt>
      <dd>
          a javascript object containing the protobuf decoded message fields.
      </dd>
      <dt>protobufType
          <span class="property-type">string</span>
      </dt>
      <dd>
          the identifier string of the corresponding protobuf type definition of the message
      </dd>
  </dl>
  <h3>Details</h3>
  <p>When supplied with a protobuf type from the protofile the node will decode the message into a javascript object.</p>
  <p>The protobufType from a message always takes precedence over the node defined type.</p>
  <p>The current settings are set such that longs, enums and strings are decoded into string and default values are not taken into account.</p>
  <p>If a message is incomplete regarding the protobuf type all fields that can be decoded will be decoded resulting in a partial decoded message at the output.</p>
</script>
